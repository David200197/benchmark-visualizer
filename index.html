<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Benchmark Framework Visualizer</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0%25' stop-color='%230a0d14'/%3E%3Cstop offset='100%25' stop-color='%23141820'/%3E%3C/linearGradient%3E%3ClinearGradient id='accent' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0%25' stop-color='%2300e1ff'/%3E%3Cstop offset='100%25' stop-color='%238b5cf6'/%3E%3C/linearGradient%3E%3ClinearGradient id='bar1' x1='0' y1='1' x2='0' y2='0'%3E%3Cstop offset='0%25' stop-color='%2300e1ff' stop-opacity='0.2'/%3E%3Cstop offset='100%25' stop-color='%2300e1ff'/%3E%3C/linearGradient%3E%3ClinearGradient id='bar2' x1='0' y1='1' x2='0' y2='0'%3E%3Cstop offset='0%25' stop-color='%238b5cf6' stop-opacity='0.2'/%3E%3Cstop offset='100%25' stop-color='%238b5cf6'/%3E%3C/linearGradient%3E%3ClinearGradient id='bar3' x1='0' y1='1' x2='0' y2='0'%3E%3Cstop offset='0%25' stop-color='%23ec4899' stop-opacity='0.2'/%3E%3Cstop offset='100%25' stop-color='%23ec4899'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='128' height='128' rx='28' fill='url(%23bg)'/%3E%3Crect x='4' y='4' width='120' height='120' rx='24' fill='none' stroke='url(%23accent)' stroke-width='2' opacity='0.3'/%3E%3Crect x='22' y='58' width='18' height='44' rx='4' fill='url(%23bar1)'/%3E%3Crect x='55' y='32' width='18' height='70' rx='4' fill='url(%23bar2)'/%3E%3Crect x='88' y='46' width='18' height='56' rx='4' fill='url(%23bar3)'/%3E%3Cpath d='M24 54 L64 28 L97 42' fill='none' stroke='%2300e1ff' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round' opacity='0.9'/%3E%3Ccircle cx='24' cy='54' r='3.5' fill='%2300e1ff'/%3E%3Ccircle cx='64' cy='28' r='3.5' fill='%2300e1ff'/%3E%3Ccircle cx='97' cy='42' r='3.5' fill='%2300e1ff'/%3E%3C/svg%3E">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-void: #05060a;
            --bg-deep: #0a0d14;
            --bg-surface: #0f1219;
            --bg-card: #141820;
            --bg-elevated: #1a1f2b;
            --border-dim: rgba(255,255,255,0.04);
            --border-subtle: rgba(255,255,255,0.07);
            --border-active: rgba(0,225,255,0.2);
            --accent-cyan: #00e1ff;
            --accent-violet: #8b5cf6;
            --accent-magenta: #ec4899;
            --accent-emerald: #10b981;
            --accent-amber: #f59e0b;
            --accent-red: #ef4444;
            --text-white: #f0f2f5;
            --text-secondary: #8892a4;
            --text-dim: #4b5563;
            --glow-cyan: 0 0 30px rgba(0,225,255,0.15), 0 0 60px rgba(0,225,255,0.05);
            --glow-violet: 0 0 30px rgba(139,92,246,0.15);
            --font-display: 'Outfit', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-display);
            background: var(--bg-void);
            color: var(--text-white);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                linear-gradient(rgba(0,225,255,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,225,255,0.02) 1px, transparent 1px);
            background-size: 60px 60px;
            mask-image: radial-gradient(ellipse 80% 60% at 50% 30%, black 20%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background:
                radial-gradient(ellipse at 15% 10%, rgba(0,225,255,0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 85% 80%, rgba(139,92,246,0.05) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(236,72,153,0.02) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1500px;
            margin: 0 auto;
            padding: 0 24px 40px;
        }

        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 24px;
            margin: 0 -24px 32px;
            background: rgba(5,6,10,0.7);
            backdrop-filter: blur(20px) saturate(1.5);
            -webkit-backdrop-filter: blur(20px) saturate(1.5);
            border-bottom: 1px solid var(--border-dim);
        }

        .header-brand {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .header-logo {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: grid;
            place-items: center;
            flex-shrink: 0;
            overflow: hidden;
        }

        .header-logo svg { width: 36px; height: 36px; }

        .header-title {
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            color: var(--text-white);
        }

        .header-subtitle {
            font-size: 0.72rem;
            color: var(--text-dim);
            font-weight: 500;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            margin-top: 1px;
        }

        .lang-toggle {
            display: flex;
            align-items: center;
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 3px;
            gap: 2px;
            flex-shrink: 0;
        }

        .lang-toggle button {
            background: transparent;
            border: none;
            padding: 7px 14px;
            color: var(--text-dim);
            cursor: pointer;
            border-radius: 8px;
            font-family: var(--font-mono);
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            transition: all 0.2s ease;
        }

        .lang-toggle button:hover { color: var(--text-secondary); }

        .lang-toggle button.active {
            background: var(--accent-cyan);
            color: var(--bg-void);
            box-shadow: 0 0 12px rgba(0,225,255,0.25);
        }

        .upload-zone {
            position: relative;
            border: 1px dashed var(--border-subtle);
            border-radius: 20px;
            padding: 80px 40px;
            text-align: center;
            margin-bottom: 32px;
            transition: all 0.3s ease;
            background: var(--bg-surface);
            overflow: hidden;
        }

        .upload-zone::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 20px;
            background: linear-gradient(135deg, rgba(0,225,255,0.02), rgba(139,92,246,0.02));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .upload-zone:hover { border-color: var(--border-active); cursor: pointer; }
        .upload-zone:hover::before { opacity: 1; }
        .upload-zone.drag-over { border-color: var(--accent-emerald); background: rgba(16,185,129,0.03); }

        .upload-zone .upload-glyph {
            width: 64px;
            height: 64px;
            margin: 0 auto 24px;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(0,225,255,0.1), rgba(139,92,246,0.1));
            border: 1px solid var(--border-subtle);
            display: grid;
            place-items: center;
        }

        .upload-zone .upload-glyph svg { width: 28px; height: 28px; stroke: var(--accent-cyan); opacity: 0.8; }
        .upload-zone h2 { font-size: 1.4rem; font-weight: 700; margin-bottom: 8px; letter-spacing: -0.02em; }
        .upload-zone p { color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 8px; }

        .upload-cta {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, var(--accent-cyan), #00b4d8);
            border: none;
            padding: 12px 32px;
            border-radius: 12px;
            color: var(--bg-void);
            font-family: var(--font-display);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s ease;
            letter-spacing: -0.01em;
        }

        .upload-cta:hover { transform: translateY(-2px); box-shadow: var(--glow-cyan); }

        #fileInput { display: none; }

        .validation-errors {
            background: rgba(239,68,68,0.06);
            border: 1px solid rgba(239,68,68,0.2);
            border-radius: 14px;
            padding: 20px 24px;
            margin-bottom: 24px;
            display: none;
        }
        .validation-errors.show { display: block; }
        .validation-errors h3 { color: var(--accent-red); font-size: 0.9rem; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .validation-errors ul { list-style: none; }
        .validation-errors li { padding: 6px 0; color: var(--text-secondary); font-size: 0.85rem; border-bottom: 1px solid rgba(239,68,68,0.08); padding-left: 16px; position: relative; }
        .validation-errors li::before { content: '›'; position: absolute; left: 0; color: var(--accent-red); font-weight: 700; }

        .dashboard { display: none; }
        .dashboard.show { display: block; }

        .metrics-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(210px, 1fr)); gap: 14px; margin-bottom: 28px; }

        .metric-card {
            background: var(--bg-card);
            border: 1px solid var(--border-dim);
            border-radius: 14px;
            padding: 20px 22px;
            position: relative;
            overflow: hidden;
            transition: all 0.25s ease;
        }

        .metric-card::after { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: var(--accent-cyan); opacity: 0.4; }
        .metric-card:nth-child(2)::after { background: var(--accent-violet); }
        .metric-card:nth-child(3)::after { background: var(--accent-magenta); }
        .metric-card:nth-child(4)::after { background: var(--accent-emerald); }
        .metric-card:nth-child(5)::after { background: var(--accent-amber); }
        .metric-card:nth-child(6)::after { background: var(--accent-red); }
        .metric-card:hover { border-color: var(--border-active); transform: translateY(-2px); }

        .metric-label { font-family: var(--font-mono); font-size: 0.68rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 8px; }
        .metric-value { font-size: 1.15rem; font-weight: 600; color: var(--text-white); letter-spacing: -0.02em; word-break: break-all; }

        .tab-strip {
            display: flex;
            gap: 4px;
            margin-bottom: 24px;
            background: var(--bg-surface);
            border: 1px solid var(--border-dim);
            padding: 4px;
            border-radius: 14px;
            overflow-x: auto;
            scrollbar-width: none;
        }
        .tab-strip::-webkit-scrollbar { display: none; }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 10px 22px;
            color: var(--text-dim);
            cursor: pointer;
            border-radius: 10px;
            font-family: var(--font-display);
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .tab-btn:hover { color: var(--text-secondary); background: rgba(255,255,255,0.02); }

        .tab-btn.active {
            background: var(--bg-elevated);
            color: var(--accent-cyan);
            border: 1px solid var(--border-subtle);
            font-weight: 600;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .empty-state {
            text-align: center;
            padding: 60px 24px;
            background: var(--bg-card);
            border: 1px dashed var(--border-subtle);
            border-radius: 16px;
        }

        .empty-state-icon {
            width: 56px; height: 56px; margin: 0 auto 16px;
            border-radius: 14px; background: rgba(255,255,255,0.03);
            border: 1px solid var(--border-dim); display: grid; place-items: center;
        }

        .empty-state-icon svg { width: 24px; height: 24px; stroke: var(--text-dim); fill: none; stroke-width: 1.5; stroke-linecap: round; stroke-linejoin: round; }
        .empty-state h3 { font-size: 1rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px; }
        .empty-state p { font-size: 0.82rem; color: var(--text-dim); font-family: var(--font-mono); }

        .section-title { display: flex; align-items: center; gap: 14px; margin-bottom: 20px; }
        .section-title h2 { font-size: 1.15rem; font-weight: 700; letter-spacing: -0.02em; color: var(--text-white); white-space: nowrap; }
        .section-title .line { flex: 1; height: 1px; background: linear-gradient(90deg, var(--border-subtle), transparent); }

        .podium-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; margin-bottom: 28px; }

        .podium-card {
            background: var(--bg-card); border: 1px solid var(--border-dim); border-radius: 16px;
            padding: 28px 24px; text-align: center; position: relative; overflow: hidden; transition: all 0.3s ease;
        }

        .podium-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: var(--border-dim); }
        .podium-card.gold::before { background: linear-gradient(90deg, #fbbf24, #f59e0b, #d97706); }
        .podium-card.silver::before { background: linear-gradient(90deg, #9ca3af, #d1d5db, #9ca3af); }
        .podium-card.bronze::before { background: linear-gradient(90deg, #b45309, #d97706, #b45309); }
        .podium-card:hover { transform: translateY(-4px); border-color: var(--border-active); box-shadow: 0 16px 48px rgba(0,0,0,0.3); }

        .podium-rank { font-family: var(--font-mono); font-size: 2.4rem; font-weight: 800; line-height: 1; margin-bottom: 8px; }
        .podium-card.gold .podium-rank { color: #fbbf24; text-shadow: 0 0 20px rgba(251,191,36,0.3); }
        .podium-card.silver .podium-rank { color: #9ca3af; }
        .podium-card.bronze .podium-rank { color: #d97706; }
        .podium-card.other .podium-rank { color: var(--text-dim); }
        .podium-name { font-weight: 700; margin-bottom: 16px; text-transform: uppercase; letter-spacing: 0.05em; font-family: var(--font-mono); font-size: 0.95rem; }
        .podium-stats { display: flex; flex-direction: column; gap: 6px; }
        .podium-stat { display: flex; justify-content: space-between; align-items: center; padding: 8px 14px; background: var(--bg-surface); border-radius: 8px; border: 1px solid var(--border-dim); }
        .podium-stat-label { font-size: 0.75rem; color: var(--text-dim); font-family: var(--font-mono); }
        .podium-stat-value { font-size: 0.85rem; font-weight: 600; color: var(--accent-emerald); font-family: var(--font-mono); }

        .podium-meta { display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 14px; flex-wrap: wrap; }
        .vs-leader-tag { font-family: var(--font-mono); font-size: 0.7rem; font-weight: 700; padding: 3px 10px; border-radius: 6px; letter-spacing: 0.03em; }
        .vs-leader-tag.is-leader { background: rgba(251,191,36,0.12); color: #fbbf24; border: 1px solid rgba(251,191,36,0.25); }
        .vs-leader-tag.close { background: rgba(16,185,129,0.1); color: var(--accent-emerald); border: 1px solid rgba(16,185,129,0.2); }
        .vs-leader-tag.mid { background: rgba(245,158,11,0.1); color: var(--accent-amber); border: 1px solid rgba(245,158,11,0.2); }
        .vs-leader-tag.far { background: rgba(239,68,68,0.1); color: var(--accent-red); border: 1px solid rgba(239,68,68,0.2); }

        .tier-badge { font-family: var(--font-mono); font-size: 0.68rem; font-weight: 800; padding: 3px 8px; border-radius: 5px; letter-spacing: 0.05em; }
        .tier-S { background: rgba(251,191,36,0.15); color: #fbbf24; border: 1px solid rgba(251,191,36,0.3); }
        .tier-A { background: rgba(16,185,129,0.12); color: #34d399; border: 1px solid rgba(16,185,129,0.25); }
        .tier-B { background: rgba(56,189,248,0.1); color: #38bdf8; border: 1px solid rgba(56,189,248,0.2); }
        .tier-C { background: rgba(245,158,11,0.1); color: #f59e0b; border: 1px solid rgba(245,158,11,0.2); }
        .tier-D { background: rgba(239,68,68,0.08); color: #f87171; border: 1px solid rgba(239,68,68,0.15); }

        .stability-row { display: flex; align-items: center; gap: 8px; width: 100%; }
        .stability-track { flex: 1; height: 4px; background: var(--bg-deep); border-radius: 4px; overflow: hidden; }
        .stability-fill { height: 100%; border-radius: 4px; transition: width 0.6s ease; }

        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(480px, 1fr)); gap: 16px; margin-bottom: 28px; }
        @media (max-width: 600px) { .charts-grid { grid-template-columns: 1fr; } }

        .chart-card { background: var(--bg-card); border: 1px solid var(--border-dim); border-radius: 16px; padding: 24px; }
        .chart-card-title { font-size: 0.85rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 18px; display: flex; align-items: center; gap: 8px; }
        .chart-card-title .dot { width: 6px; height: 6px; border-radius: 50%; background: var(--accent-cyan); }
        .chart-container { position: relative; height: 280px; }

        .table-card { background: var(--bg-card); border: 1px solid var(--border-dim); border-radius: 16px; padding: 24px; margin-bottom: 20px; overflow-x: auto; }
        .table-card-title { font-size: 0.85rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 16px; }

        .data-table { width: 100%; border-collapse: collapse; font-size: 0.82rem; }
        .data-table th { background: var(--bg-surface); color: var(--accent-cyan); padding: 12px 14px; text-align: left; font-family: var(--font-mono); font-weight: 600; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.06em; border-bottom: 1px solid var(--border-subtle); }
        .data-table td { padding: 11px 14px; border-bottom: 1px solid var(--border-dim); color: var(--text-secondary); font-family: var(--font-mono); font-size: 0.8rem; }
        .data-table tr:hover td { background: rgba(0,225,255,0.02); color: var(--text-white); }
        .data-table .fw-name { font-weight: 600; color: var(--text-white); }
        .data-table .hl-green { color: var(--accent-emerald); font-weight: 600; }
        .data-table .hl-red { color: var(--accent-red); font-weight: 600; }
        .data-table .hl-amber { color: var(--accent-amber); font-weight: 600; }

        .rank-badge { display: inline-flex; align-items: center; justify-content: center; width: 30px; height: 30px; border-radius: 8px; font-family: var(--font-mono); font-weight: 700; font-size: 0.8rem; }
        .rank-1 { background: rgba(251,191,36,0.15); color: #fbbf24; border: 1px solid rgba(251,191,36,0.3); }
        .rank-2 { background: rgba(156,163,175,0.1); color: #d1d5db; border: 1px solid rgba(156,163,175,0.2); }
        .rank-3 { background: rgba(217,119,6,0.1); color: #d97706; border: 1px solid rgba(217,119,6,0.2); }
        .rank-other { background: var(--bg-surface); color: var(--text-dim); border: 1px solid var(--border-dim); }

        .status-badge { display: inline-flex; align-items: center; gap: 4px; padding: 3px 10px; border-radius: 6px; font-family: var(--font-mono); font-size: 0.7rem; font-weight: 600; }
        .status-pass { background: rgba(16,185,129,0.1); color: var(--accent-emerald); border: 1px solid rgba(16,185,129,0.2); }
        .status-fail { background: rgba(239,68,68,0.1); color: var(--accent-red); border: 1px solid rgba(239,68,68,0.2); }

        .progress-card { background: var(--bg-card); border: 1px solid var(--border-dim); border-radius: 16px; padding: 24px; margin-bottom: 20px; }
        .progress-item { margin-bottom: 16px; }
        .progress-item:last-child { margin-bottom: 0; }
        .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        .progress-label { font-family: var(--font-mono); font-size: 0.8rem; font-weight: 500; color: var(--text-white); }
        .progress-value { font-family: var(--font-mono); font-size: 0.75rem; color: var(--accent-cyan); font-weight: 600; }
        .progress-track { height: 6px; background: var(--bg-surface); border-radius: 6px; overflow: hidden; border: 1px solid var(--border-dim); }
        .progress-fill { height: 100%; border-radius: 6px; transition: width 0.8s cubic-bezier(0.16, 1, 0.3, 1); }

        .download-section { text-align: center; padding: 36px 20px; border-top: 1px solid var(--border-dim); margin-top: 20px; }

        .download-btn {
            display: inline-flex; align-items: center; gap: 10px;
            background: var(--bg-elevated); border: 1px solid var(--border-subtle);
            padding: 14px 36px; border-radius: 12px; color: var(--accent-emerald);
            font-family: var(--font-display); font-size: 0.9rem; font-weight: 600;
            cursor: pointer; transition: all 0.25s ease;
        }
        .download-btn:hover { border-color: rgba(16,185,129,0.3); background: rgba(16,185,129,0.05); transform: translateY(-2px); box-shadow: 0 0 20px rgba(16,185,129,0.1); }
        .download-btn svg { width: 18px; height: 18px; }

        .footer { text-align: center; padding: 24px; color: var(--text-dim); font-size: 0.75rem; font-family: var(--font-mono); border-top: 1px solid var(--border-dim); margin-top: 20px; }

        .loading-overlay { position: fixed; inset: 0; background: rgba(5,6,10,0.92); backdrop-filter: blur(8px); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .loading-overlay.show { display: flex; }
        .spinner-ring { width: 44px; height: 44px; border: 2px solid var(--border-subtle); border-top-color: var(--accent-cyan); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        @keyframes fadeUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeUp 0.5s ease forwards; opacity: 0; }
        .delay-1 { animation-delay: 0.05s; } .delay-2 { animation-delay: 0.1s; } .delay-3 { animation-delay: 0.15s; } .delay-4 { animation-delay: 0.2s; } .delay-5 { animation-delay: 0.25s; }

        @media (max-width: 768px) {
            .header { flex-wrap: wrap; gap: 12px; padding: 12px 16px; }
            .header-brand { min-width: 0; flex: 1; }
            .header-title { font-size: 0.95rem; }
            .container { padding: 0 14px 30px; }
            .upload-zone { padding: 50px 24px; }
            .metrics-row { grid-template-columns: repeat(2, 1fr); }
            .charts-grid { grid-template-columns: 1fr; }
            .podium-grid { grid-template-columns: 1fr; }
            .tab-strip { -webkit-overflow-scrolling: touch; }
            .data-table th, .data-table td { padding: 8px 10px; }
        }
        @media (max-width: 480px) { .metrics-row { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-brand">
                <div class="header-logo">
                    <svg viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="hdr-bg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#0a0d14"/><stop offset="100%" stop-color="#141820"/></linearGradient>
                            <linearGradient id="hdr-accent" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#00e1ff"/><stop offset="100%" stop-color="#8b5cf6"/></linearGradient>
                            <linearGradient id="hdr-b1" x1="0" y1="1" x2="0" y2="0"><stop offset="0%" stop-color="#00e1ff" stop-opacity="0.2"/><stop offset="100%" stop-color="#00e1ff"/></linearGradient>
                            <linearGradient id="hdr-b2" x1="0" y1="1" x2="0" y2="0"><stop offset="0%" stop-color="#8b5cf6" stop-opacity="0.2"/><stop offset="100%" stop-color="#8b5cf6"/></linearGradient>
                            <linearGradient id="hdr-b3" x1="0" y1="1" x2="0" y2="0"><stop offset="0%" stop-color="#ec4899" stop-opacity="0.2"/><stop offset="100%" stop-color="#ec4899"/></linearGradient>
                        </defs>
                        <rect width="128" height="128" rx="28" fill="url(#hdr-bg)"/>
                        <rect x="4" y="4" width="120" height="120" rx="24" fill="none" stroke="url(#hdr-accent)" stroke-width="2" opacity="0.3"/>
                        <rect x="22" y="58" width="18" height="44" rx="4" fill="url(#hdr-b1)"/>
                        <rect x="55" y="32" width="18" height="70" rx="4" fill="url(#hdr-b2)"/>
                        <rect x="88" y="46" width="18" height="56" rx="4" fill="url(#hdr-b3)"/>
                        <path d="M24 54 L64 28 L97 42" fill="none" stroke="#00e1ff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" opacity="0.9"/>
                        <circle cx="24" cy="54" r="3.5" fill="#00e1ff"/>
                        <circle cx="64" cy="28" r="3.5" fill="#00e1ff"/>
                        <circle cx="97" cy="42" r="3.5" fill="#00e1ff"/>
                    </svg>
                </div>
                <div>
                    <div class="header-title">Benchmark Visualizer</div>
                    <div class="header-subtitle" data-i18n="header.subtitle">Panel de Análisis de Rendimiento</div>
                </div>
            </div>
            <div class="lang-toggle">
                <button class="active" data-lang="es">ES</button>
                <button data-lang="en">EN</button>
            </div>
        </header>

        <section class="upload-zone" id="uploadSection">
            <div class="upload-glyph">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
            </div>
            <h2 data-i18n="upload.title">Cargar result.json</h2>
            <p data-i18n="upload.description">Arrastra y suelta el archivo result.json generado por Benchmark Framework, o haz clic para seleccionarlo</p>
            <p style="font-family:var(--font-mono);font-size:0.72rem;color:var(--text-dim);margin-bottom:24px;" data-i18n="upload.hint">Ruta habitual: ~/FrameworkBenchmarks/results/result.json</p>
            <button class="upload-cta" id="uploadBtn" data-i18n="upload.button">Seleccionar result.json</button>
            <input type="file" id="fileInput" accept=".json">
        </section>

        <div class="validation-errors" id="validationErrors">
            <h3>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                <span data-i18n="validation.title">Errores de Validación</span>
            </h3>
            <ul id="errorList"></ul>
        </div>

        <div class="dashboard" id="dashboard">
            <div class="metrics-row" id="infoGrid"></div>
            <div class="tab-strip" id="mainTabs"></div>

            <div class="tab-content active" id="tab-overview">
                <div class="section-title"><h2 data-i18n="overview.topFrameworks">Top Frameworks</h2><div class="line"></div></div>
                <div class="podium-grid" id="topFrameworks"></div>
                <div class="section-title"><h2 data-i18n="overview.generalPerformance">Rendimiento General</h2><div class="line"></div></div>
                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-card-title"><span class="dot"></span><span data-i18n="charts.totalRequests">Total de Requests</span></div>
                        <div class="chart-container"><canvas id="totalRequestsChart"></canvas></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-card-title"><span class="dot" style="background:var(--accent-violet)"></span><span data-i18n="charts.avgLatency">Latencia Promedio</span></div>
                        <div class="chart-container"><canvas id="avgLatencyChart"></canvas></div>
                    </div>
                </div>
            </div>

            <div id="dynamicTabContents"></div>

            <div class="tab-content" id="tab-comparison">
                <div class="section-title"><h2 data-i18n="comparison.title">Comparación de Frameworks</h2><div class="line"></div></div>
                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-card-title"><span class="dot"></span><span data-i18n="comparison.latencyComparison">Comparación de Latencia Promedio</span></div>
                        <div class="chart-container"><canvas id="comparisonLatencyChart"></canvas></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-card-title"><span class="dot" style="background:var(--accent-magenta)"></span><span data-i18n="comparison.throughputComparison">Comparación de Throughput</span></div>
                        <div class="chart-container"><canvas id="comparisonThroughputChart"></canvas></div>
                    </div>
                </div>
                <div class="progress-card">
                    <div class="table-card-title" data-i18n="comparison.relativePerformance">Rendimiento Relativo</div>
                    <div id="progressBars"></div>
                </div>
            </div>

            <div class="tab-content" id="tab-rankings">
                <div class="section-title"><h2 data-i18n="rankings.title">Rankings y Estadísticas</h2><div class="line"></div></div>
                <div class="table-card">
                    <div class="table-card-title" data-i18n="rankings.generalRanking">Ranking General</div>
                    <table class="data-table" id="rankingTable">
                        <thead><tr>
                            <th data-i18n="table.position">Posición</th>
                            <th data-i18n="table.framework">Framework</th>
                            <th data-i18n="table.tier">Tier</th>
                            <th data-i18n="table.totalRequests">Requests Totales</th>
                            <th data-i18n="table.reqPerSec">Req/s</th>
                            <th data-i18n="table.vsLeader">% vs Líder</th>
                            <th data-i18n="table.latencyMin">Latencia Min</th>
                            <th data-i18n="table.latencyMax">Latencia Max</th>
                            <th data-i18n="table.verification">Verificación</th>
                            <th>SLOC</th>
                        </tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="table-card">
                    <div class="table-card-title" data-i18n="rankings.testMetadata">Metadatos del Test</div>
                    <table class="data-table" id="metadataTable">
                        <thead><tr>
                            <th data-i18n="table.property">Propiedad</th>
                            <th data-i18n="table.value">Valor</th>
                        </tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div class="download-section" id="downloadSection">
                <button class="download-btn" id="downloadBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    <span data-i18n="download.button">Descargar Reporte Estático</span>
                </button>
            </div>
        </div>

        <footer class="footer"><p data-i18n="footer.text">Benchmark Framework Visualizer — Generado automáticamente</p></footer>
    </div>

    <div class="loading-overlay" id="loadingOverlay"><div class="spinner-ring"></div></div>

    <script>
        // ============================================
        // TEST TYPE REGISTRY
        // ============================================
        const testTypeRegistry = {
            json:           { labelEs: 'JSON Serialization', labelEn: 'JSON Serialization', useLevels: 'concurrencyLevels', levelPrefix: 'C', hasTimeouts: false },
            plaintext:      { labelEs: 'Plaintext',          labelEn: 'Plaintext',          useLevels: 'pipelineConcurrencyLevels', levelPrefix: 'P', hasTimeouts: true },
            db:             { labelEs: 'Single Query (DB)',  labelEn: 'Single Query (DB)',  useLevels: 'concurrencyLevels', levelPrefix: 'C', hasTimeouts: false },
            query:          { labelEs: 'Multiple Queries',   labelEn: 'Multiple Queries',   useLevels: 'queryIntervals',    levelPrefix: 'Q', hasTimeouts: false },
            fortune:        { labelEs: 'Fortunes',           labelEn: 'Fortunes',           useLevels: 'concurrencyLevels', levelPrefix: 'C', hasTimeouts: false },
            update:         { labelEs: 'Data Updates',       labelEn: 'Data Updates',       useLevels: 'queryIntervals',    levelPrefix: 'U', hasTimeouts: false },
            'cached-query': { labelEs: 'Cached Queries',     labelEn: 'Cached Queries',     useLevels: 'queryIntervals',    levelPrefix: 'Q', hasTimeouts: false }
        };

        function getTestTypeConfig(type) {
            if (testTypeRegistry[type]) return testTypeRegistry[type];
            const pretty = type.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
            return { labelEs: pretty, labelEn: pretty, useLevels: 'concurrencyLevels', levelPrefix: 'C', hasTimeouts: false };
        }

        // ============================================
        // i18n
        // ============================================
        const i18n = {
            currentLang: 'es',
            translations: {
                es: {
                    'header.subtitle': 'Panel de Análisis de Rendimiento',
                    'upload.title': 'Cargar result.json',
                    'upload.description': 'Arrastra y suelta el archivo result.json generado por Benchmark Framework, o haz clic para seleccionarlo',
                    'upload.button': 'Seleccionar result.json',
                    'upload.hint': 'Ruta habitual: ~/FrameworkBenchmarks/results/result.json',
                    'validation.title': 'Errores de Validación',
                    'validation.requiredField': 'Campo requerido faltante',
                    'validation.frameworksArray': "'frameworks' debe ser un array",
                    'validation.frameworksEmpty': "El array 'frameworks' está vacío",
                    'validation.rawDataType': 'debe ser un objeto',
                    'validation.rawDataTypeArray': 'debe ser un array',
                    'validation.parseError': 'Error al parsear JSON',
                    'validation.readError': 'Error al leer el archivo',
                    'validation.warning': 'Advertencia',
                    'validation.missingLatency': 'latencyAvg faltante',
                    'validation.missingRequests': 'totalRequests faltante',
                    'tabs.overview': 'Resumen',
                    'tabs.comparison': 'Comparación',
                    'tabs.rankings': 'Rankings',
                    'overview.topFrameworks': 'Top Frameworks',
                    'overview.generalPerformance': 'Rendimiento General',
                    'charts.totalRequests': 'Total de Requests',
                    'charts.avgLatency': 'Latencia Promedio',
                    'comparison.title': 'Comparación de Frameworks',
                    'comparison.latencyComparison': 'Comparación de Latencia Promedio',
                    'comparison.throughputComparison': 'Comparación de Throughput',
                    'comparison.relativePerformance': 'Rendimiento Relativo',
                    'rankings.title': 'Rankings y Estadísticas',
                    'rankings.generalRanking': 'Ranking General',
                    'rankings.testMetadata': 'Metadatos del Test',
                    'table.framework': 'Framework', 'table.concurrency': 'Concurrencia', 'table.pipeline': 'Pipeline', 'table.level': 'Nivel',
                    'table.latencyAvg': 'Latencia Avg', 'table.latencyMax': 'Latencia Max', 'table.latencyMin': 'Latencia Min',
                    'table.stdDev': 'Std Dev', 'table.totalRequests': 'Total Requests', 'table.timeouts': 'Timeouts',
                    'table.position': 'Posición', 'table.verification': 'Verificación', 'table.property': 'Propiedad', 'table.value': 'Valor',
                    'download.button': 'Descargar Reporte Estático',
                    'footer.text': 'Benchmark Framework Visualizer',
                    'info.uuid': 'UUID', 'info.testedFrameworks': 'Frameworks Testeados',
                    'info.operatingSystem': 'Sistema Operativo',
                    'top.totalRequests': 'Total Requests', 'top.minLatency': 'Latencia Mín', 'top.linesOfCode': 'Líneas de Código',
                    'top.vsLeader': 'vs Líder', 'top.reqPerSec': 'Req/s Promedio', 'top.latencyStability': 'Estabilidad',
                    'top.leader': 'LÍDER', 'top.multiplierVsLast': 'vs Último',
                    'table.vsLeader': '% vs Líder', 'table.reqPerSec': 'Req/s', 'table.tier': 'Tier',
                    'info.totalRequests': 'Requests Totales', 'info.bestFramework': 'Mejor Framework', 'info.bestReqSec': 'Mejor Req/s',
                    'progress.requests': 'requests',
                    'metadata.uuid': 'UUID', 'metadata.name': 'Nombre', 'metadata.environment': 'Entorno',
                    'metadata.gitRepo': 'Git Repository', 'metadata.gitBranch': 'Git Branch', 'metadata.gitCommit': 'Git Commit',
                    'metadata.os': 'Sistema Operativo', 'metadata.startDate': 'Fecha Inicio', 'metadata.endDate': 'Fecha Fin',
                    'metadata.testDuration': 'Duración Test', 'metadata.seconds': 'segundos',
                    'chart.latencyMs': 'Latencia (ms)', 'chart.concurrencyLevel': 'Nivel de Concurrencia',
                    'chart.pipelineConcurrency': 'Pipeline Concurrency', 'chart.totalRequestsLabel': 'Total Requests',
                    'chart.avgLatencyMs': 'Latencia Promedio (ms)', 'chart.levelLabel': 'Nivel',
                    'status.pass': 'pasó', 'status.fail': 'falló',
                    'testtype.latencyByLevel': 'Latencia por Nivel', 'testtype.requestsByLevel': 'Requests por Nivel',
                    'testtype.detailedData': 'Datos Detallados',
                    'testtype.noData': 'Sin datos de prueba',
                    'testtype.noDataDesc': 'El archivo JSON no contiene datos para este tipo de prueba',
                    'testtype.testTypes': 'Tipos de prueba'
                },
                en: {
                    'header.subtitle': 'Framework Performance Analysis',
                    'upload.title': 'Load result.json',
                    'upload.description': 'Drag and drop the result.json file generated by Benchmark Framework, or click to select it',
                    'upload.button': 'Select result.json',
                    'upload.hint': 'Typical path: ~/FrameworkBenchmarks/results/result.json',
                    'validation.title': 'Validation Errors',
                    'validation.requiredField': 'Missing required field',
                    'validation.frameworksArray': "'frameworks' must be an array",
                    'validation.frameworksEmpty': "The 'frameworks' array is empty",
                    'validation.rawDataType': 'must be an object',
                    'validation.rawDataTypeArray': 'must be an array',
                    'validation.parseError': 'Error parsing JSON',
                    'validation.readError': 'Error reading file',
                    'validation.warning': 'Warning',
                    'validation.missingLatency': 'latencyAvg missing',
                    'validation.missingRequests': 'totalRequests missing',
                    'tabs.overview': 'Overview',
                    'tabs.comparison': 'Comparison',
                    'tabs.rankings': 'Rankings',
                    'overview.topFrameworks': 'Top Frameworks',
                    'overview.generalPerformance': 'General Performance',
                    'charts.totalRequests': 'Total Requests',
                    'charts.avgLatency': 'Average Latency',
                    'comparison.title': 'Framework Comparison',
                    'comparison.latencyComparison': 'Average Latency Comparison',
                    'comparison.throughputComparison': 'Throughput Comparison',
                    'comparison.relativePerformance': 'Relative Performance',
                    'rankings.title': 'Rankings and Statistics',
                    'rankings.generalRanking': 'General Ranking',
                    'rankings.testMetadata': 'Test Metadata',
                    'table.framework': 'Framework', 'table.concurrency': 'Concurrency', 'table.pipeline': 'Pipeline', 'table.level': 'Level',
                    'table.latencyAvg': 'Latency Avg', 'table.latencyMax': 'Latency Max', 'table.latencyMin': 'Latency Min',
                    'table.stdDev': 'Std Dev', 'table.totalRequests': 'Total Requests', 'table.timeouts': 'Timeouts',
                    'table.position': 'Position', 'table.verification': 'Verification', 'table.property': 'Property', 'table.value': 'Value',
                    'download.button': 'Download Static Report',
                    'footer.text': 'Benchmark Framework Visualizer',
                    'info.uuid': 'UUID', 'info.testedFrameworks': 'Tested Frameworks',
                    'info.operatingSystem': 'Operating System',
                    'top.totalRequests': 'Total Requests', 'top.minLatency': 'Min Latency', 'top.linesOfCode': 'Lines of Code',
                    'top.vsLeader': 'vs Leader', 'top.reqPerSec': 'Avg Req/s', 'top.latencyStability': 'Stability',
                    'top.leader': 'LEADER', 'top.multiplierVsLast': 'vs Last',
                    'table.vsLeader': '% vs Leader', 'table.reqPerSec': 'Req/s', 'table.tier': 'Tier',
                    'info.totalRequests': 'Total Requests', 'info.bestFramework': 'Best Framework', 'info.bestReqSec': 'Best Req/s',
                    'progress.requests': 'requests',
                    'metadata.uuid': 'UUID', 'metadata.name': 'Name', 'metadata.environment': 'Environment',
                    'metadata.gitRepo': 'Git Repository', 'metadata.gitBranch': 'Git Branch', 'metadata.gitCommit': 'Git Commit',
                    'metadata.os': 'Operating System', 'metadata.startDate': 'Start Date', 'metadata.endDate': 'End Date',
                    'metadata.testDuration': 'Test Duration', 'metadata.seconds': 'seconds',
                    'chart.latencyMs': 'Latency (ms)', 'chart.concurrencyLevel': 'Concurrency Level',
                    'chart.pipelineConcurrency': 'Pipeline Concurrency', 'chart.totalRequestsLabel': 'Total Requests',
                    'chart.avgLatencyMs': 'Average Latency (ms)', 'chart.levelLabel': 'Level',
                    'status.pass': 'pass', 'status.fail': 'fail',
                    'testtype.latencyByLevel': 'Latency by Level', 'testtype.requestsByLevel': 'Requests by Level',
                    'testtype.detailedData': 'Detailed Data',
                    'testtype.noData': 'No test data',
                    'testtype.noDataDesc': 'The JSON file does not contain data for this test type',
                    'testtype.testTypes': 'Test types'
                }
            },
            t(key) { return this.translations[this.currentLang][key] || key; },
            setLanguage(lang) {
                if (this.translations[lang]) {
                    this.currentLang = lang;
                    try { localStorage.setItem('benchmark-lang', lang); } catch(e) {}
                    this.updateAllTexts();
                    document.documentElement.lang = lang;
                    if (benchmarkData) {
                        renderInfoCards(benchmarkData);
                        renderTopFrameworks(benchmarkData);
                        renderDynamicTabs(benchmarkData);
                        renderRankingTable(benchmarkData);
                        renderMetadataTable(benchmarkData);
                        renderProgressBars(benchmarkData);
                        updateChartLabels();
                    }
                }
            },
            updateAllTexts() {
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    const translation = this.t(key);
                    if (translation) el.textContent = translation;
                });
            }
        };

        // ============================================
        // GLOBALS
        // ============================================
        let benchmarkData = null;
        let rawSourceData = null;
        let charts = {};
        let detectedTestTypes = [];

        const frameworkColors = {
            elysia:  { main: '#f472b6', light: 'rgba(244,114,182,0.15)' },
            express: { main: '#4ade80', light: 'rgba(74,222,128,0.15)' },
            fastify: { main: '#38bdf8', light: 'rgba(56,189,248,0.15)' },
            hono:    { main: '#fb923c', light: 'rgba(251,146,60,0.15)' },
            titanpl: { main: '#a78bfa', light: 'rgba(167,139,250,0.15)' }
        };

        const defaultColors = [
            { main: '#818cf8', light: 'rgba(129,140,248,0.15)' },
            { main: '#f0abfc', light: 'rgba(240,171,252,0.15)' },
            { main: '#34d399', light: 'rgba(52,211,153,0.15)' },
            { main: '#fbbf24', light: 'rgba(251,191,36,0.15)' },
            { main: '#fb7185', light: 'rgba(251,113,133,0.15)' }
        ];

        // ============================================
        // UTILS
        // ============================================
        function getFrameworkColor(fw, idx) { return frameworkColors[fw] || defaultColors[idx % defaultColors.length]; }

        function parseLatency(str) {
            if (!str) return 0;
            const s = str.toString().toLowerCase();
            let v = parseFloat(s);
            if (s.includes('ms')) return v;
            if (s.includes('us')) return v / 1000;
            if (s.includes('s') && !s.includes('ms')) return v * 1000;
            return v;
        }

        function fmt(n) { return n.toLocaleString(); }
        function fmtDate(ts) { if (!ts) return 'N/A'; return new Date(ts).toLocaleString(); }
        function showLoading() { var el = document.getElementById('loadingOverlay'); if (el) el.classList.add('show'); }
        function hideLoading() { var el = document.getElementById('loadingOverlay'); if (el) el.classList.remove('show'); }
        function getTestTypeLabel(type) { const cfg = getTestTypeConfig(type); return i18n.currentLang === 'en' ? cfg.labelEn : cfg.labelEs; }

        // ============================================
        // VALIDATION
        // ============================================
        function validateBenchmarkData(data) {
            const errors = [], warnings = [];
            ['frameworks', 'rawData'].forEach(f => { if (!data[f]) errors.push(`${i18n.t('validation.requiredField')}: '${f}'`); });
            if (data.frameworks) {
                if (!Array.isArray(data.frameworks)) errors.push(i18n.t('validation.frameworksArray'));
                else if (data.frameworks.length === 0) errors.push(i18n.t('validation.frameworksEmpty'));
            }
            if (data.rawData) {
                Object.keys(data.rawData).forEach(type => {
                    if (type === 'slocCounts') return;
                    if (data.rawData[type] && typeof data.rawData[type] !== 'object')
                        errors.push(`rawData.${type} ${i18n.t('validation.rawDataType')}`);
                });
                if (data.frameworks && Array.isArray(data.frameworks)) {
                    data.frameworks.forEach(fw => {
                        Object.keys(data.rawData).forEach(tt => {
                            if (tt === 'slocCounts') return;
                            if (data.rawData[tt] && data.rawData[tt][fw]) {
                                const td = data.rawData[tt][fw];
                                if (!Array.isArray(td)) {
                                    errors.push(`rawData.${tt}.${fw} ${i18n.t('validation.rawDataTypeArray')}`);
                                } else {
                                    td.forEach((e, idx) => {
                                        if (!e.latencyAvg && e.latencyAvg !== 0) warnings.push(`rawData.${tt}.${fw}[${idx}].${i18n.t('validation.missingLatency')}`);
                                        if (!e.totalRequests && e.totalRequests !== 0) warnings.push(`rawData.${tt}.${fw}[${idx}].${i18n.t('validation.missingRequests')}`);
                                    });
                                }
                            }
                        });
                    });
                }
            }
            if (data.concurrencyLevels && !Array.isArray(data.concurrencyLevels)) errors.push("'concurrencyLevels' must be an array");
            if (data.pipelineConcurrencyLevels && !Array.isArray(data.pipelineConcurrencyLevels)) errors.push("'pipelineConcurrencyLevels' must be an array");
            return { errors, warnings, isValid: errors.length === 0 };
        }

        function showValidationErrors(errors, warnings) {
            const container = document.getElementById('validationErrors');
            const list = document.getElementById('errorList');
            list.innerHTML = '';
            errors.forEach(e => { const li = document.createElement('li'); li.textContent = e; li.style.color = 'var(--accent-red)'; list.appendChild(li); });
            warnings.forEach(w => { const li = document.createElement('li'); li.textContent = `${i18n.t('validation.warning')}: ${w}`; li.style.color = 'var(--accent-amber)'; list.appendChild(li); });
            container.classList.add('show');
        }

        // ============================================
        // DATA PROCESSING
        // ============================================
        function processBenchmarkData(data) {
            const excludeKeys = ['slocCounts'];
            const foundTypes = data.rawData
                ? Object.keys(data.rawData).filter(k => !excludeKeys.includes(k) && typeof data.rawData[k] === 'object' && data.rawData[k] !== null)
                : [];
            detectedTestTypes = foundTypes;

            const processed = {
                frameworks: data.frameworks || [],
                concurrencyLevels: data.concurrencyLevels || [],
                pipelineConcurrencyLevels: data.pipelineConcurrencyLevels || [],
                queryIntervals: data.queryIntervals || [],
                duration: data.duration || 15,
                testTypes: foundTypes,
                testData: {}
            };

            foundTypes.forEach(type => {
                processed.testData[type] = {};
                if (data.rawData[type]) {
                    data.frameworks.forEach(fw => {
                        if (data.rawData[type][fw]) {
                            processed.testData[type][fw] = data.rawData[type][fw].map(e => ({
                                latencyAvg: parseLatency(e.latencyAvg),
                                latencyStdev: parseLatency(e.latencyStdev),
                                latencyMax: parseLatency(e.latencyMax),
                                totalRequests: e.totalRequests || 0,
                                timeout: e.timeout || 0,
                                startTime: e.startTime,
                                endTime: e.endTime
                            }));
                        }
                    });
                }
            });

            processed.json = processed.testData.json || {};
            processed.plaintext = processed.testData.plaintext || {};
            processed.summary = calculateSummary(data, processed);
            processed.metadata = {
                uuid: data.uuid, name: data.name, environment: data.environmentDescription,
                git: data.git, os: data.operatingSystem,
                startTime: data.startTime, completionTime: data.completionTime,
                duration: data.duration, succeeded: data.succeeded, failed: data.failed,
                verify: data.verify, slocCounts: data.rawData?.slocCounts || {}
            };
            return processed;
        }

        function calculateSummary(data, processed) {
            const summary = { byFramework: {}, rankings: [] };
            const duration = data.duration || 15;

            data.frameworks.forEach(fw => {
                let totalRequests = 0, minLatency = Infinity, maxLatency = 0, latencies = [], stdevs = [];
                let requestsByType = {};

                processed.testTypes.forEach(type => {
                    const typeData = processed.testData[type] || {};
                    let typeReqs = 0;
                    if (typeData[fw]) {
                        typeData[fw].forEach(e => {
                            totalRequests += e.totalRequests; typeReqs += e.totalRequests;
                            if (e.latencyAvg > 0) { latencies.push(e.latencyAvg); minLatency = Math.min(minLatency, e.latencyAvg); }
                            if (e.latencyStdev > 0) stdevs.push(e.latencyStdev);
                            maxLatency = Math.max(maxLatency, e.latencyMax);
                        });
                    }
                    requestsByType[type] = typeReqs;
                });

                const avgLatency = latencies.length > 0 ? latencies.reduce((a, b) => a + b, 0) / latencies.length : 0;
                const avgStdev = stdevs.length > 0 ? stdevs.reduce((a, b) => a + b, 0) / stdevs.length : 0;
                const cv = avgLatency > 0 ? (avgStdev / avgLatency) : 0;
                const stability = Math.max(0, Math.round((1 - Math.min(cv, 1)) * 100));
                let numTests = 0;
                processed.testTypes.forEach(type => { numTests += (processed.testData[type]?.[fw]?.length || 0); });
                const reqPerSec = numTests > 0 ? Math.round(totalRequests / (numTests * duration)) : 0;

                summary.byFramework[fw] = {
                    totalRequests, requestsByType,
                    jsonRequests: requestsByType.json || 0, plaintextRequests: requestsByType.plaintext || 0,
                    minLatency: minLatency === Infinity ? 0 : minLatency, maxLatency, avgLatency, avgStdev,
                    stability, reqPerSec, verify: data.verify?.[fw] || {}
                };
            });

            summary.rankings = Object.keys(summary.byFramework)
                .map(fw => ({ framework: fw, ...summary.byFramework[fw] }))
                .sort((a, b) => b.totalRequests - a.totalRequests);

            if (summary.rankings.length > 0) {
                const leaderReqs = summary.rankings[0].totalRequests;
                const lastReqs = summary.rankings[summary.rankings.length - 1].totalRequests;
                summary.rankings.forEach((item) => {
                    item.pctOfLeader = leaderReqs > 0 ? Math.round((item.totalRequests / leaderReqs) * 100) : 0;
                    item.multiplierVsLast = lastReqs > 0 ? (item.totalRequests / lastReqs) : 0;
                    if (item.pctOfLeader >= 95) item.tier = 'S';
                    else if (item.pctOfLeader >= 75) item.tier = 'A';
                    else if (item.pctOfLeader >= 50) item.tier = 'B';
                    else if (item.pctOfLeader >= 25) item.tier = 'C';
                    else item.tier = 'D';
                    summary.byFramework[item.framework].pctOfLeader = item.pctOfLeader;
                    summary.byFramework[item.framework].tier = item.tier;
                    summary.byFramework[item.framework].multiplierVsLast = item.multiplierVsLast;
                });
            }
            return summary;
        }

        // ============================================
        // RENDERING
        // ============================================
        function renderInfoCards(data) {
            const c = document.getElementById('infoGrid');
            const leader = data.summary.rankings[0];
            const allReqs = data.summary.rankings.reduce((s, r) => s + r.totalRequests, 0);
            const cards = [
                { label: i18n.t('info.uuid'), value: data.metadata.uuid?.substring(0, 8) + '…' || 'N/A' },
                { label: i18n.t('info.testedFrameworks'), value: data.frameworks.length },
                { label: i18n.t('info.totalRequests'), value: fmt(allReqs) },
                { label: i18n.t('info.bestFramework'), value: leader ? leader.framework : 'N/A' },
                { label: i18n.t('info.bestReqSec'), value: leader ? fmt(leader.reqPerSec) + '/s' : 'N/A' },
                { label: i18n.t('testtype.testTypes'), value: data.testTypes.length + ' (' + data.testTypes.join(', ') + ')' },
            ];
            c.innerHTML = cards.map((card, i) => `
                <div class="metric-card animate-in delay-${i + 1}">
                    <div class="metric-label">${card.label}</div>
                    <div class="metric-value">${card.value}</div>
                </div>`).join('');
        }

        function renderTopFrameworks(data) {
            const c = document.getElementById('topFrameworks');
            const rankings = data.summary.rankings.slice(0, 5);
            const classes = ['gold','silver','bronze','other','other'];
            c.innerHTML = rankings.map((item, i) => {
                const sloc = data.metadata.slocCounts[item.framework] || 'N/A';
                const isLeader = i === 0;
                let vsTag = isLeader
                    ? `<span class="vs-leader-tag is-leader">★ ${i18n.t('top.leader')}</span>`
                    : (() => { const gap = 100 - item.pctOfLeader; const cls = gap <= 15 ? 'close' : gap <= 40 ? 'mid' : 'far'; return `<span class="vs-leader-tag ${cls}">${item.pctOfLeader}% ${i18n.t('top.vsLeader')}</span>`; })();
                const tierTag = `<span class="tier-badge tier-${item.tier}">TIER ${item.tier}</span>`;
                const stabColor = item.stability >= 80 ? 'var(--accent-emerald)' : item.stability >= 50 ? 'var(--accent-amber)' : 'var(--accent-red)';
                const multStr = item.multiplierVsLast >= 1.1 ? item.multiplierVsLast.toFixed(1) + 'x' : '—';
                const typeReqParts = data.testTypes.filter(t => item.requestsByType[t] > 0).map(t => getTestTypeLabel(t).split(' ')[0] + ': ' + fmt(item.requestsByType[t]));
                const typeReqStr = typeReqParts.length > 0 ? typeReqParts.join(' / ') : '—';
                return `<div class="podium-card ${classes[i]} animate-in delay-${i + 1}">
                    <div class="podium-rank">#${i + 1}</div>
                    <div class="podium-name">${item.framework}</div>
                    <div class="podium-meta">${vsTag} ${tierTag}</div>
                    <div class="podium-stats">
                        <div class="podium-stat"><span class="podium-stat-label">${i18n.t('top.totalRequests')}</span><span class="podium-stat-value">${fmt(item.totalRequests)}</span></div>
                        <div class="podium-stat"><span class="podium-stat-label">${i18n.t('top.reqPerSec')}</span><span class="podium-stat-value">${fmt(item.reqPerSec)}/s</span></div>
                        <div class="podium-stat"><span class="podium-stat-label">${i18n.t('top.minLatency')}</span><span class="podium-stat-value">${item.minLatency.toFixed(3)} ms</span></div>
                        <div class="podium-stat"><span class="podium-stat-label">${i18n.t('top.latencyStability')}</span><span class="podium-stat-value"><span class="stability-row"><span class="stability-track"><span class="stability-fill" style="width:${item.stability}%;background:${stabColor};"></span></span>${item.stability}%</span></span></div>
                        <div class="podium-stat"><span class="podium-stat-label">Req / Type</span><span class="podium-stat-value" style="font-size:0.7rem;">${typeReqStr}</span></div>
                        <div class="podium-stat"><span class="podium-stat-label">${i18n.t('top.multiplierVsLast')}</span><span class="podium-stat-value">${multStr}</span></div>
                        <div class="podium-stat"><span class="podium-stat-label">${i18n.t('top.linesOfCode')}</span><span class="podium-stat-value">${typeof sloc === 'number' ? fmt(sloc) : sloc}</span></div>
                    </div>
                </div>`;
            }).join('');
        }

        // ============================================
        // DYNAMIC TABS
        // ============================================
        function renderDynamicTabs(data) {
            const tabStrip = document.getElementById('mainTabs');
            const dynamicContainer = document.getElementById('dynamicTabContents');

            // Destroy dynamic charts before rebuilding
            data.testTypes.forEach(type => {
                if (charts[`${type}Latency`]) { charts[`${type}Latency`].destroy(); delete charts[`${type}Latency`]; }
                if (charts[`${type}Requests`]) { charts[`${type}Requests`].destroy(); delete charts[`${type}Requests`]; }
            });

            // Tab buttons
            let tabsHTML = `<button class="tab-btn active" data-tab="overview">${i18n.t('tabs.overview')}</button>`;
            data.testTypes.forEach(type => { tabsHTML += `<button class="tab-btn" data-tab="tt-${type}">${getTestTypeLabel(type)}</button>`; });
            tabsHTML += `<button class="tab-btn" data-tab="comparison">${i18n.t('tabs.comparison')}</button>`;
            tabsHTML += `<button class="tab-btn" data-tab="rankings">${i18n.t('tabs.rankings')}</button>`;
            tabStrip.innerHTML = tabsHTML;

            // Tab content
            let contentHTML = '';
            data.testTypes.forEach(type => {
                const cfg = getTestTypeConfig(type);
                const typeData = data.testData[type] || {};
                const hasData = Object.keys(typeData).some(fw => typeData[fw] && typeData[fw].length > 0);
                const label = getTestTypeLabel(type);

                contentHTML += `<div class="tab-content" id="tab-tt-${type}">`;
                contentHTML += `<div class="section-title"><h2>${label} Test</h2><div class="line"></div></div>`;

                if (!hasData) {
                    contentHTML += `<div class="empty-state">
                        <div class="empty-state-icon"><svg viewBox="0 0 24 24"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/><polyline points="13 2 13 9 20 9"/><line x1="9" y1="14" x2="15" y2="14"/></svg></div>
                        <h3>${i18n.t('testtype.noData')}</h3>
                        <p>${i18n.t('testtype.noDataDesc')}</p>
                    </div>`;
                } else {
                    contentHTML += `<div class="charts-grid">
                        <div class="chart-card"><div class="chart-card-title"><span class="dot"></span><span>${i18n.t('testtype.latencyByLevel')} — ${label}</span></div><div class="chart-container"><canvas id="chart-latency-${type}"></canvas></div></div>
                        <div class="chart-card"><div class="chart-card-title"><span class="dot" style="background:var(--accent-violet)"></span><span>${i18n.t('testtype.requestsByLevel')} — ${label}</span></div><div class="chart-container"><canvas id="chart-requests-${type}"></canvas></div></div>
                    </div>`;
                    let timeoutHeader = cfg.hasTimeouts ? `<th>${i18n.t('table.timeouts')}</th>` : '';
                    contentHTML += `<div class="table-card"><div class="table-card-title">${i18n.t('testtype.detailedData')} — ${label}</div>
                        <table class="data-table" id="table-${type}"><thead><tr>
                            <th>${i18n.t('table.framework')}</th><th>${i18n.t('table.level')}</th><th>${i18n.t('table.latencyAvg')}</th><th>${i18n.t('table.latencyMax')}</th><th>${i18n.t('table.stdDev')}</th><th>${i18n.t('table.totalRequests')}</th>${timeoutHeader}
                        </tr></thead><tbody></tbody></table></div>`;
                }
                contentHTML += `</div>`;
            });

            dynamicContainer.innerHTML = contentHTML;

            // Render charts & tables for types with data
            data.testTypes.forEach(type => {
                const typeData = data.testData[type] || {};
                const hasData = Object.keys(typeData).some(fw => typeData[fw] && typeData[fw].length > 0);
                if (hasData) { renderTestTypeCharts(data, type); renderTestTypeTable(data, type); }
            });

            attachTabListeners();
        }

        function getLevelsForType(data, type) {
            const cfg = getTestTypeConfig(type);
            let levels = data[cfg.useLevels] || data.concurrencyLevels || [];
            if (levels.length === 0) {
                const typeData = data.testData[type] || {};
                const firstFw = Object.keys(typeData).find(fw => typeData[fw] && typeData[fw].length > 0);
                if (firstFw) levels = typeData[firstFw].map((_, i) => i + 1);
            }
            return levels;
        }

        function renderTestTypeCharts(data, type) {
            const cfg = getTestTypeConfig(type);
            const typeData = data.testData[type] || {};
            const levels = getLevelsForType(data, type);

            const latencyCanvas = document.getElementById(`chart-latency-${type}`);
            const requestsCanvas = document.getElementById(`chart-requests-${type}`);

            if (latencyCanvas) {
                charts[`${type}Latency`] = new Chart(latencyCanvas.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: levels.map(c => `${cfg.levelPrefix}:${c}`),
                        datasets: data.frameworks.map((fw, i) => ({
                            label: fw,
                            data: (typeData[fw] || []).map(d => d.latencyAvg),
                            borderColor: getFrameworkColor(fw, i).main,
                            backgroundColor: getFrameworkColor(fw, i).light,
                            tension: 0.4, fill: false, pointRadius: 3, pointHoverRadius: 5, borderWidth: 2
                        }))
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { position: 'top', labels: { usePointStyle: true, pointStyle: 'circle', padding: 16, font: { size: 11 } } } },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: i18n.t('chart.latencyMs'), font: { size: 11 } }, grid: { color: 'rgba(255,255,255,0.03)' } },
                            x: { title: { display: true, text: i18n.t('chart.levelLabel'), font: { size: 11 } }, grid: { display: false } }
                        }
                    }
                });
            }

            if (requestsCanvas) {
                charts[`${type}Requests`] = new Chart(requestsCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: levels.map(c => `${cfg.levelPrefix}:${c}`),
                        datasets: data.frameworks.map((fw, i) => ({
                            label: fw,
                            data: (typeData[fw] || []).map(d => d.totalRequests),
                            backgroundColor: getFrameworkColor(fw, i).light,
                            borderColor: getFrameworkColor(fw, i).main,
                            borderWidth: 1, borderRadius: 4
                        }))
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { position: 'top', labels: { usePointStyle: true, pointStyle: 'circle', padding: 16, font: { size: 11 } } } },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: i18n.t('chart.totalRequestsLabel'), font: { size: 11 } }, grid: { color: 'rgba(255,255,255,0.03)' } },
                            x: { grid: { display: false } }
                        }
                    }
                });
            }
        }

        function renderTestTypeTable(data, type) {
            const cfg = getTestTypeConfig(type);
            const typeData = data.testData[type] || {};
            const levels = getLevelsForType(data, type);
            const table = document.querySelector(`#table-${type} tbody`);
            if (!table) return;
            table.innerHTML = '';
            data.frameworks.forEach(fw => {
                (typeData[fw] || []).forEach((e, i) => {
                    const level = levels[i] || 'N/A';
                    const cls = e.latencyAvg < 1 ? 'hl-green' : e.latencyAvg > 3 ? 'hl-red' : 'hl-amber';
                    const r = document.createElement('tr');
                    let html = `<td class="fw-name">${fw}</td><td>${cfg.levelPrefix}:${level}</td><td class="${cls}">${e.latencyAvg.toFixed(3)} ms</td><td>${e.latencyMax.toFixed(3)} ms</td><td>${e.latencyStdev.toFixed(3)} ms</td><td>${fmt(e.totalRequests)}</td>`;
                    if (cfg.hasTimeouts) html += `<td class="${e.timeout > 0 ? 'hl-red' : 'hl-green'}">${e.timeout || 0}</td>`;
                    r.innerHTML = html;
                    table.appendChild(r);
                });
            });
        }

        function renderOverviewCharts(data) {
            Chart.defaults.color = '#6b7280';
            Chart.defaults.borderColor = 'rgba(255,255,255,0.04)';
            Chart.defaults.font.family = "'Outfit', sans-serif";
            const barOpts = () => ({ responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.03)' } }, x: { grid: { display: false } } } });
            charts.totalRequests = new Chart(document.getElementById('totalRequestsChart').getContext('2d'), { type: 'bar', data: { labels: data.frameworks, datasets: [{ label: i18n.t('chart.totalRequestsLabel'), data: data.frameworks.map(fw => data.summary.byFramework[fw]?.totalRequests || 0), backgroundColor: data.frameworks.map((fw, i) => getFrameworkColor(fw, i).light), borderColor: data.frameworks.map((fw, i) => getFrameworkColor(fw, i).main), borderWidth: 1.5, borderRadius: 6 }] }, options: barOpts() });
            charts.avgLatency = new Chart(document.getElementById('avgLatencyChart').getContext('2d'), { type: 'bar', data: { labels: data.frameworks, datasets: [{ label: i18n.t('chart.avgLatencyMs'), data: data.frameworks.map(fw => data.summary.byFramework[fw]?.avgLatency || 0), backgroundColor: data.frameworks.map((fw, i) => getFrameworkColor(fw, i).light), borderColor: data.frameworks.map((fw, i) => getFrameworkColor(fw, i).main), borderWidth: 1.5, borderRadius: 6 }] }, options: barOpts() });
        }

        function renderComparisonCharts(data) {
            const radarLabels = []; const radarDataFns = [];
            data.testTypes.forEach(type => {
                const typeData = data.testData[type] || {};
                const shortLabel = getTestTypeLabel(type).split(' ')[0];
                const hasData = Object.keys(typeData).some(fw => typeData[fw] && typeData[fw].length > 0);
                if (hasData) {
                    radarLabels.push(i18n.t('table.latencyMin') + ' ' + shortLabel, i18n.t('table.latencyMax') + ' ' + shortLabel, 'Req ' + shortLabel);
                    radarDataFns.push((fw) => { const d = typeData[fw] || []; return [ d.length ? Math.min(...d.map(x => x.latencyAvg)) : 0, d.length ? Math.max(...d.map(x => x.latencyAvg)) : 0, d.reduce((s, x) => s + x.totalRequests, 0) / 100000 ]; });
                }
            });
            charts.comparisonLatency = new Chart(document.getElementById('comparisonLatencyChart').getContext('2d'), { type: 'radar', data: { labels: radarLabels, datasets: data.frameworks.map((fw, i) => ({ label: fw, data: radarDataFns.flatMap(fn => fn(fw)), borderColor: getFrameworkColor(fw, i).main, backgroundColor: getFrameworkColor(fw, i).light, borderWidth: 2, pointBackgroundColor: getFrameworkColor(fw, i).main, pointRadius: 3 })) }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top', labels: { usePointStyle: true, pointStyle: 'circle', padding: 16, font: { size: 11 } } } }, scales: { r: { grid: { color: 'rgba(255,255,255,0.04)' }, angleLines: { color: 'rgba(255,255,255,0.04)' }, pointLabels: { color: '#6b7280', font: { size: 10 } } } } } });
            charts.comparisonThroughput = new Chart(document.getElementById('comparisonThroughputChart').getContext('2d'), { type: 'doughnut', data: { labels: data.frameworks, datasets: [{ data: data.frameworks.map(fw => data.summary.byFramework[fw]?.totalRequests || 0), backgroundColor: data.frameworks.map((fw, i) => getFrameworkColor(fw, i).main), borderColor: '#141820', borderWidth: 3 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { usePointStyle: true, pointStyle: 'circle', padding: 16, font: { size: 11 } } } } } });
        }

        function updateChartLabels() {
            if (charts.totalRequests) { charts.totalRequests.data.datasets[0].label = i18n.t('chart.totalRequestsLabel'); charts.totalRequests.update(); }
            if (charts.avgLatency) { charts.avgLatency.data.datasets[0].label = i18n.t('chart.avgLatencyMs'); charts.avgLatency.update(); }
        }

        function renderRankingTable(data) {
            const rtb = document.querySelector('#rankingTable tbody'); rtb.innerHTML = '';
            data.summary.rankings.forEach((item, i) => {
                const rc = i < 3 ? `rank-${i+1}` : 'rank-other';
                const v = data.metadata.verify?.[item.framework] || {};
                const sloc = data.metadata.slocCounts?.[item.framework] || 'N/A';
                const isLeader = i === 0;
                const vsStr = isLeader ? '<span class="vs-leader-tag is-leader" style="font-size:0.65rem;">★ ' + i18n.t('top.leader') + '</span>' : '<span style="color:var(--text-secondary);">' + item.pctOfLeader + '%</span>';
                const r = document.createElement('tr');
                r.innerHTML = `<td><span class="rank-badge ${rc}">${i+1}</span></td><td class="fw-name">${item.framework}</td><td><span class="tier-badge tier-${item.tier}">TIER ${item.tier}</span></td><td>${fmt(item.totalRequests)}</td><td style="color:var(--accent-cyan);font-weight:600;">${fmt(item.reqPerSec)}/s</td><td>${vsStr}</td><td class="hl-green">${item.minLatency.toFixed(3)} ms</td><td class="hl-red">${item.maxLatency.toFixed(3)} ms</td><td>${Object.entries(v).map(([k,val])=>`<span class="status-badge ${val==='pass'?'status-pass':'status-fail'}">${k}: ${val}</span>`).join(' ')}</td><td>${typeof sloc === 'number' ? fmt(sloc) : sloc}</td>`;
                rtb.appendChild(r);
            });
        }

        function renderMetadataTable(data) {
            const mtb = document.querySelector('#metadataTable tbody'); mtb.innerHTML = '';
            [
                [i18n.t('metadata.uuid'), data.metadata.uuid || 'N/A'],
                [i18n.t('metadata.name'), data.metadata.name || 'N/A'],
                [i18n.t('metadata.environment'), data.metadata.environment || 'N/A'],
                [i18n.t('metadata.gitRepo'), data.metadata.git?.repositoryUrl || 'N/A'],
                [i18n.t('metadata.gitBranch'), data.metadata.git?.branchName || 'N/A'],
                [i18n.t('metadata.gitCommit'), data.metadata.git?.commitId?.substring(0, 12) || 'N/A'],
                [i18n.t('metadata.os'), `${data.metadata.os?.name || 'N/A'} ${data.metadata.os?.version || ''}`],
                [i18n.t('metadata.startDate'), fmtDate(data.metadata.startTime)],
                [i18n.t('metadata.endDate'), fmtDate(data.metadata.completionTime)],
                [i18n.t('metadata.testDuration'), `${data.duration || 15} ${i18n.t('metadata.seconds')}`],
                [i18n.t('testtype.testTypes'), data.testTypes.join(', ')]
            ].forEach(([k, v]) => { const r = document.createElement('tr'); r.innerHTML = `<td style="font-weight:600;color:var(--accent-cyan);">${k}</td><td>${v}</td>`; mtb.appendChild(r); });
        }

        function renderProgressBars(data) {
            const c = document.getElementById('progressBars');
            const max = Math.max(...data.frameworks.map(fw => data.summary.byFramework[fw]?.totalRequests || 0));
            c.innerHTML = data.summary.rankings.map((item, i) => {
                const fw = item.framework; const total = item.totalRequests;
                const pct = max > 0 ? (total / max) * 100 : 0;
                const color = getFrameworkColor(fw, data.frameworks.indexOf(fw)).main;
                const vsLabel = i === 0 ? '★ 100%' : item.pctOfLeader + '%';
                return `<div class="progress-item"><div class="progress-header"><span class="progress-label">${fw} <span style="color:var(--text-dim);font-size:0.7rem;margin-left:6px;">${vsLabel}</span></span><span class="progress-value">${fmt(total)} ${i18n.t('progress.requests')}</span></div><div class="progress-track"><div class="progress-fill" style="width:${pct}%;background:${color};"></div></div></div>`;
            }).join('');
        }

        function attachTabListeners() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    const target = document.getElementById(`tab-${tabId}`);
                    if (target) target.classList.add('active');
                });
            });
        }

        function renderDashboard(data) {
            var uploadEl = document.getElementById('uploadSection');
            if (uploadEl) uploadEl.style.display = 'none';
            document.getElementById('dashboard').classList.add('show');
            Object.values(charts).forEach(ch => { try { ch.destroy(); } catch(e) {} });
            charts = {};
            renderInfoCards(data);
            renderTopFrameworks(data);
            renderDynamicTabs(data);
            renderOverviewCharts(data);
            renderComparisonCharts(data);
            renderRankingTable(data);
            renderMetadataTable(data);
            renderProgressBars(data);
        }

        // ============================================
        // FILE HANDLING
        // ============================================
        function handleFile(file) {
            showLoading();
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    const validation = validateBenchmarkData(data);
                    if (!validation.isValid) { showValidationErrors(validation.errors, validation.warnings); hideLoading(); return; }
                    if (validation.warnings.length > 0) showValidationErrors([], validation.warnings);
                    else document.getElementById('validationErrors').classList.remove('show');
                    rawSourceData = data;
                    benchmarkData = processBenchmarkData(data);
                    renderDashboard(benchmarkData);
                    hideLoading();
                } catch (error) { showValidationErrors([`${i18n.t('validation.parseError')}: ${error.message}`], []); hideLoading(); }
            };
            reader.onerror = function() { showValidationErrors([i18n.t('validation.readError')], []); hideLoading(); };
            reader.readAsText(file);
        }

        function loadFromEmbeddedData(data) {
            document.querySelectorAll('canvas').forEach(function(canvas) { var parent = canvas.parentNode; var fresh = document.createElement('canvas'); fresh.id = canvas.id; parent.replaceChild(fresh, canvas); });
            rawSourceData = data;
            benchmarkData = processBenchmarkData(data);
            renderDashboard(benchmarkData);
        }

        // ============================================
        // DOWNLOAD
        // ============================================
        function downloadStaticHTML() {
            if (!rawSourceData) return;
            showLoading();
            setTimeout(() => {
                try {
                    const clone = document.documentElement.cloneNode(true);
                    ['uploadSection', 'downloadSection', 'validationErrors', 'loadingOverlay'].forEach(id => { const el = clone.querySelector('#' + id); if (el) el.remove(); });
                    clone.querySelectorAll('input[type="file"]').forEach(el => el.remove());
                    clone.querySelectorAll('canvas').forEach(c => { const fresh = document.createElement('canvas'); fresh.id = c.id; c.parentNode.replaceChild(fresh, c); });
                    ['infoGrid', 'topFrameworks', 'progressBars', 'dynamicTabContents'].forEach(id => { const el = clone.querySelector('#' + id); if (el) el.innerHTML = ''; });
                    clone.querySelectorAll('tbody').forEach(tb => tb.innerHTML = '');
                    const dashboard = clone.querySelector('#dashboard');
                    if (dashboard) dashboard.className = 'dashboard show';
                    // Clear dynamic tab strip so it re-renders from data
                    const tabStrip = clone.querySelector('#mainTabs');
                    if (tabStrip) tabStrip.innerHTML = '';
                    const dataScript = document.createElement('script');
                    dataScript.textContent = 'var __EMBEDDED_BENCHMARK_DATA__ = ' + JSON.stringify(rawSourceData) + ';\nvar __EMBEDDED_LANG__ = "' + i18n.currentLang + '";';
                    const mainScript = clone.querySelector('body > script:not([src])');
                    if (mainScript) mainScript.parentNode.insertBefore(dataScript, mainScript);
                    else clone.querySelector('body').appendChild(dataScript);
                    const html = '<!DOCTYPE html>\n' + clone.outerHTML;
                    const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a'); a.href = url; a.download = 'benchmark-report-' + Date.now() + '.html';
                    document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
                } catch(err) { console.error('Download error:', err); } finally { hideLoading(); }
            }, 100);
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            var isEmbedded = typeof __EMBEDDED_BENCHMARK_DATA__ !== 'undefined';
            if (isEmbedded) {
                var eLang = typeof __EMBEDDED_LANG__ !== 'undefined' ? __EMBEDDED_LANG__ : 'es';
                if (i18n.translations[eLang]) { i18n.currentLang = eLang; i18n.updateAllTexts(); document.documentElement.lang = eLang; document.querySelectorAll('.lang-toggle button').forEach(function(btn) { btn.classList.toggle('active', btn.dataset.lang === eLang); }); }
                loadFromEmbeddedData(__EMBEDDED_BENCHMARK_DATA__);
            } else {
                try { var savedLang = localStorage.getItem('benchmark-lang'); if (savedLang && i18n.translations[savedLang]) { i18n.currentLang = savedLang; i18n.updateAllTexts(); document.documentElement.lang = savedLang; document.querySelectorAll('.lang-toggle button').forEach(function(btn) { btn.classList.toggle('active', btn.dataset.lang === savedLang); }); } } catch(e) {}
            }

            document.querySelectorAll('.lang-toggle button').forEach(btn => { btn.addEventListener('click', function() { const lang = this.dataset.lang; i18n.setLanguage(lang); document.querySelectorAll('.lang-toggle button').forEach(b => b.classList.remove('active')); this.classList.add('active'); }); });

            const uploadBtn = document.getElementById('uploadBtn');
            const fileInput = document.getElementById('fileInput');
            if (uploadBtn && fileInput) { uploadBtn.addEventListener('click', function(e) { e.preventDefault(); e.stopPropagation(); fileInput.click(); }); }
            if (fileInput) { fileInput.addEventListener('change', function(e) { if (e.target.files.length > 0) handleFile(e.target.files[0]); }); }

            const uploadSection = document.getElementById('uploadSection');
            if (uploadSection) {
                uploadSection.addEventListener('click', function(e) { if (e.target !== uploadBtn && fileInput) fileInput.click(); });
                uploadSection.addEventListener('dragover', function(e) { e.preventDefault(); uploadSection.classList.add('drag-over'); });
                uploadSection.addEventListener('dragleave', function(e) { e.preventDefault(); uploadSection.classList.remove('drag-over'); });
                uploadSection.addEventListener('drop', function(e) { e.preventDefault(); uploadSection.classList.remove('drag-over'); if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]); });
            }

            const downloadBtn = document.getElementById('downloadBtn');
            if (downloadBtn) { downloadBtn.addEventListener('click', function() { downloadStaticHTML(); }); }
        });
    </script>
</body>
</html>
